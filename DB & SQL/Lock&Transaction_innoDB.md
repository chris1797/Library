# InnoDB의 동시성 제어

innoDB는 MySQL의 기본 스토리지 엔진으로, 트랜잭션과 잠금(Lock)을 통해 데이터의 무결성과 동시성을 보장한다.

<br/>


## Transaction
- 트랜잭션(Transaction)이란 DB에서 하나의 논리적인 작업 단위이다. 100% 실행(commit) 되거나 실패됨을 보장해야 한다.
- InnoDB는 트랜잭션을 통해 원자성(Atomicity), 일관성(Consistency), 고립성(Isolation), 지속성(Durability)을 보장한다.

<br/>

## Lock (잠금)
잠금(Locking)은 데이터베이스에서 동시성을 관리하고 데이터 무결성을 유지하기 위해 사용된다.


### 1. 레코드 잠금 (Row Lock)
  - 특정 행(row)만 잠근다.
  - 트랜잭션이 특정 행에 대해 읽기나 쓰기 작업을 수행할 때, 해당 행만 잠그므로 다른 트랜잭션은 다른 행에 자유롭게 접근 가능하다.
  - 동시성을 크게 향상시키는 InnoDB의 핵심 기능이다.

### 2. 테이블 잠금 (Table Lock)
- 테이블 전체를 잠근다.
- 테이블에 큰 변화를 가하거나 특정 시점에 전체 데이터 보호가 필요할 때 사용된다.
- 일반적으로 MyISAM의 테이블 잠금 방식보다 세부적인 제어를 제공하지 않음.
  
### 3. 갭 잠금 (Gap Lock)
- 범위 내의 존재하지 않는 행을 잠근다.
- 삽입(INSERT) 작업에서 팬텀 문제를 방지하기 위해 사용된다. <br/>
    ** `팬텀 문제` : 트랜잭션 실행 중, 다른 트랜잭션이 새로운 행을 삽입해 조회 결과가 달라지는 문제.
- 주로 REPEATABLE READ 격리 수준에서 활성화된다.

<br/>

---

## 잠금과 트랜잭션 격리 수준
InnoDB의 잠금은 트랜잭션의 격리 수준에 따라 동작이 달라진다.
격리 수준은 동시성 제어와 일관성 간의 균형을 조정하는 데 사용된다.

### 1. READ UNCOMMITTED
- 변경 중인 데이터를 다른 트랜잭션이 읽을 수 있다.
- 잠금 최소화, 그러나 일관성 보장이 약하다.
### 2. READ COMMITTED
- 커밋된 데이터만 읽을 수 있다.
- 레코드 잠금을 최소화하며 동시성을 높인다.
### 3. REPEATABLE READ (기본값)
- 동일 트랜잭션 내에서 같은 데이터 조회 결과가 항상 동일하다.
- 갭 잠금을 사용하여 팬텀 문제를 방지한다.
### 4. SERIALIZABLE
- 트랜잭션 간의 완전한 고립을 보장한다.
- 동시성을 제한하지만, 가장 높은 데이터 일관성을 보장한다.
